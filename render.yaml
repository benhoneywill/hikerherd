# This file defines the deployment infrastructure for http://render.com

# Create preview environments each time a PR is made (disabled for now)

# previewsEnabled: true
# previewsExpireAfterDays: 3

# This gives us a Postgresql database

databases:
  - name: hikerherd_postgres_db
    databaseName: hikerherd

    # Pricing plans for prod and preview dbs

    plan: free
    # previewPlan: free

services:
  - type: web
    # This is our web service, which runs the app itself

    name: hikerherd_blitz_app
    env: node

    # Pricing plans for prod and preview apps

    plan: free
    # previewPlan: free

    # Build and start commands

    buildCommand: yarn --frozen-lockfile --prod=false && yarn build && yarn migrate
    startCommand: yarn start

    # Define all of the env vars for the app

    envVars:
      - key: NODE_ENV
        value: production

      - key: DATABASE_URL
        fromDatabase:
          name: hikerherd_postgres_db
          property: connectionString

      - key: SESSION_SECRET_KEY
        generateValue: true

      - key: BLITZ_PUBLIC_APP_ORIGIN
        value: https://www.hikerherd.com

      - key: POSTMARK_API_TOKEN
        previewValue: API_TEST_TOKEN
        sync: false # (Keep secrets out of version control)
